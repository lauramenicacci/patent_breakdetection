#         end_rect = case_when(coef < 0 ~ end_rect == NA),
#         cf_lwr = case_when(coef < 0 ~ cf_lwr == NA),
#         cf_upr = case_when(coef < 0 ~ cf_upr == NA),
#         cf = case_when(coef < 0 ~ cf == NA)
plot_counterfactual_positive(mod_noIIS$is[[1]])
plot_counterfactual_positive <- function(x, plus_t = 5, facet.scales = "free", title = NULL, zero_line = FALSE){
id <- c("DistrictofColumbia", "Kentucky", "SouthCarolina", "Tennessee", "Virginia", "Wisconsin")
time <- c(2011, 2007, 2008, 2005, 2005, 2014)
my_ident_fesis <- data.frame(id, time)
res <- identify_effects(x)
res$coef <- ifelse(res$coef<=0, NA, res$coef)
res$cf_upr <- ifelse(res$coef<=0, NA, res$cf_up)
res$cf_lwr <- ifelse(res$coef<=0, NA, res$cf_lwr)
res$cf <- ifelse(res$coef<=0, NA, res$cf)
sub_title <- NULL
ggplot(res, aes_(
x = ~time,
y = ~fitted,
group = ~id
)) -> g
if(zero_line){g = g + geom_hline(aes(yintercept = 0))}
g +
geom_line(aes_(y = ~y, color = "black"), size = 0.7) +
geom_rect(data = res, aes_(xmin = ~start_rect, xmax = ~end_rect, ymin = -Inf, ymax = Inf, group = ~name),fill = "grey",alpha = 0.1, na.rm = TRUE) +
geom_line(aes(color = "blue"),linetype = 1, size = 0.5) +
# fesis
geom_vline(data = my_ident_fesis, aes_(xintercept = ~time,color="red")) +
geom_ribbon(data = res, aes_(ymin = ~cf_lwr, ymax = ~cf_upr, fill = "red", group = ~name), alpha = 0.5, na.rm = FALSE) +
geom_line(data = res, aes_(y = ~cf, color = "red", group = ~name), na.rm = TRUE) +
# Faceting
facet_wrap("id", scales = facet.scales) +
scale_color_identity(name = NULL,
breaks = c("black", "blue", "grey", "purple", "red","darkgreen", "orange"),
labels = c("y","Fitted","IIS","SIS","FESIS","CFESIS", "CSIS"),
guide = "legend") +
scale_linetype(name = "Variable") +
guides(fill = "none") +
theme(
strip.background = element_blank(),
legend.key = element_rect(fill = NA),
panel.border = element_rect(colour = "grey",fill = NA),
panel.background = element_blank(),
) +
labs(title = title, subtitle = sub_title, y = NULL, x = NULL) -> plotoutput
return(plotoutput)
}
plot_counterfactual_positive(mod_noIIS$is[[1]])
res$cf_upr <- ifelse(res$coef<=0, NA, res$cf_up)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(gets)
library(getspanel)
library(here)
library(doParallel)
library(readxl)
library(gdata)
library(cowplot)
mod <- readRDS(".\\model_spec\\results\\mods_main_updatedpackage.RDS")
mod_noIIS <- readRDS(".\\model_spec\\results\\mods_main_updatedpackage_noIIS.RDS")
plot_counterfactual_positive <- function(x, plus_t = 5, facet.scales = "free", title = NULL, zero_line = FALSE){
id <- c("DistrictofColumbia", "Kentucky", "SouthCarolina", "Tennessee", "Virginia", "Wisconsin")
time <- c(2011, 2007, 2008, 2005, 2005, 2014)
my_ident_fesis <- data.frame(id, time)
res <- identify_effects(x)
res$coef <- ifelse(res$coef<=0, NA, res$coef)
res$cf_upr <- ifelse(res$coef<=0, NA, res$cf_upr)
res$cf_lwr <- ifelse(res$coef<=0, NA, res$cf_lwr)
res$cf <- ifelse(res$coef<=0, NA, res$cf)
sub_title <- NULL
ggplot(res, aes_(
x = ~time,
y = ~fitted,
group = ~id
)) -> g
if(zero_line){g = g + geom_hline(aes(yintercept = 0))}
g +
geom_line(aes_(y = ~y, color = "black"), size = 0.7) +
geom_rect(data = res, aes_(xmin = ~start_rect, xmax = ~end_rect, ymin = -Inf, ymax = Inf, group = ~name),fill = "grey",alpha = 0.1, na.rm = TRUE) +
geom_line(aes(color = "blue"),linetype = 1, size = 0.5) +
# fesis
geom_vline(data = my_ident_fesis, aes_(xintercept = ~time,color="red")) +
geom_ribbon(data = res, aes_(ymin = ~cf_lwr, ymax = ~cf_upr, fill = "red", group = ~name), alpha = 0.5, na.rm = FALSE) +
geom_line(data = res, aes_(y = ~cf, color = "red", group = ~name), na.rm = TRUE) +
# Faceting
facet_wrap("id", scales = facet.scales) +
scale_color_identity(name = NULL,
breaks = c("black", "blue", "grey", "purple", "red","darkgreen", "orange"),
labels = c("y","Fitted","IIS","SIS","FESIS","CFESIS", "CSIS"),
guide = "legend") +
scale_linetype(name = "Variable") +
guides(fill = "none") +
theme(
strip.background = element_blank(),
legend.key = element_rect(fill = NA),
panel.border = element_rect(colour = "grey",fill = NA),
panel.background = element_blank(),
) +
labs(title = title, subtitle = sub_title, y = NULL, x = NULL) -> plotoutput
return(plotoutput)
}
plot_counterfactual_positive(mod_noIIS$is[[1]])
plot_counterfactual_positive <- function(x, plus_t = 5, facet.scales = "free", title = NULL, zero_line = FALSE){
id <- c("DistrictofColumbia", "Kentucky", "SouthCarolina", "Tennessee", "Virginia", "Wisconsin")
time <- c(2011, 2007, 2008, 2005, 2005, 2014)
my_ident_fesis <- data.frame(id, time)
res <- identify_effects(x)
res$coef <- ifelse(res$coef<=0, NA, res$coef)
res$cf_upr <- ifelse(res$coef<=0, NA, res$cf_upr)
res$cf_lwr <- ifelse(res$coef<=0, NA, res$cf_lwr)
res$cf <- ifelse(res$coef<=0, NA, res$cf)
res <- res %>% filter(id %in% id)
sub_title <- NULL
ggplot(res, aes_(
x = ~time,
y = ~fitted,
group = ~id
)) -> g
if(zero_line){g = g + geom_hline(aes(yintercept = 0))}
g +
geom_line(aes_(y = ~y, color = "black"), size = 0.7) +
geom_rect(data = res, aes_(xmin = ~start_rect, xmax = ~end_rect, ymin = -Inf, ymax = Inf, group = ~name),fill = "grey",alpha = 0.1, na.rm = TRUE) +
geom_line(aes(color = "blue"),linetype = 1, size = 0.5) +
# fesis
geom_vline(data = my_ident_fesis, aes_(xintercept = ~time,color="red")) +
geom_ribbon(data = res, aes_(ymin = ~cf_lwr, ymax = ~cf_upr, fill = "red", group = ~name), alpha = 0.5, na.rm = FALSE) +
geom_line(data = res, aes_(y = ~cf, color = "red", group = ~name), na.rm = TRUE) +
# Faceting
facet_wrap("id", scales = facet.scales) +
scale_color_identity(name = NULL,
breaks = c("black", "blue", "grey", "purple", "red","darkgreen", "orange"),
labels = c("y","Fitted","IIS","SIS","FESIS","CFESIS", "CSIS"),
guide = "legend") +
scale_linetype(name = "Variable") +
guides(fill = "none") +
theme(
strip.background = element_blank(),
legend.key = element_rect(fill = NA),
panel.border = element_rect(colour = "grey",fill = NA),
panel.background = element_blank(),
) +
labs(title = title, subtitle = sub_title, y = NULL, x = NULL) -> plotoutput
return(plotoutput)
}
plot_counterfactual_positive(mod_noIIS$is[[1]])
plot_counterfactual_positive <- function(x, plus_t = 5, facet.scales = "free", title = NULL, zero_line = FALSE){
id <- c("DistrictofColumbia", "Kentucky", "SouthCarolina", "Tennessee", "Virginia", "Wisconsin")
time <- c(2011, 2007, 2008, 2005, 2005, 2014)
my_ident_fesis <- data.frame(id, time)
res <- identify_effects(x)
res$coef <- ifelse(res$coef<=0, NA, res$coef)
res$cf_upr <- ifelse(res$coef<=0, NA, res$cf_upr)
res$cf_lwr <- ifelse(res$coef<=0, NA, res$cf_lwr)
res$cf <- ifelse(res$coef<=0, NA, res$cf)
res1 <- res %>% filter(id %in% id)
sub_title <- NULL
ggplot(res1, aes_(
x = ~time,
y = ~fitted,
group = ~id
)) -> g
if(zero_line){g = g + geom_hline(aes(yintercept = 0))}
g +
geom_line(aes_(y = ~y, color = "black"), size = 0.7) +
geom_rect(data = res1, aes_(xmin = ~start_rect, xmax = ~end_rect, ymin = -Inf, ymax = Inf, group = ~name),fill = "grey",alpha = 0.1, na.rm = TRUE) +
geom_line(aes(color = "blue"),linetype = 1, size = 0.5) +
# fesis
geom_vline(data = my_ident_fesis, aes_(xintercept = ~time,color="red")) +
geom_ribbon(data = res1, aes_(ymin = ~cf_lwr, ymax = ~cf_upr, fill = "red", group = ~name), alpha = 0.5, na.rm = FALSE) +
geom_line(data = res1, aes_(y = ~cf, color = "red", group = ~name), na.rm = TRUE) +
# Faceting
facet_wrap("id", scales = facet.scales) +
scale_color_identity(name = NULL,
breaks = c("black", "blue", "grey", "purple", "red","darkgreen", "orange"),
labels = c("y","Fitted","IIS","SIS","FESIS","CFESIS", "CSIS"),
guide = "legend") +
scale_linetype(name = "Variable") +
guides(fill = "none") +
theme(
strip.background = element_blank(),
legend.key = element_rect(fill = NA),
panel.border = element_rect(colour = "grey",fill = NA),
panel.background = element_blank(),
) +
labs(title = title, subtitle = sub_title, y = NULL, x = NULL) -> plotoutput
return(plotoutput)
}
plot_counterfactual_positive(mod_noIIS$is[[1]])
plot_counterfactual_positive <- function(x, plus_t = 5, facet.scales = "free", title = NULL, zero_line = FALSE){
id <- c("DistrictofColumbia", "Kentucky", "SouthCarolina", "Tennessee", "Virginia", "Wisconsin")
time <- c(2011, 2007, 2008, 2005, 2005, 2014)
my_ident_fesis <- data.frame(id, time)
res <- identify_effects(x)
res$coef <- ifelse(res$coef<=0, NA, res$coef)
res$cf_upr <- ifelse(res$coef<=0, NA, res$cf_upr)
res$cf_lwr <- ifelse(res$coef<=0, NA, res$cf_lwr)
res$cf <- ifelse(res$coef<=0, NA, res$cf)
res1 <- res %>% filter(id %in% c("DistrictofColumbia", "Kentucky", "SouthCarolina", "Tennessee", "Virginia", "Wisconsin"))
sub_title <- NULL
ggplot(res1, aes_(
x = ~time,
y = ~fitted,
group = ~id
)) -> g
if(zero_line){g = g + geom_hline(aes(yintercept = 0))}
g +
geom_line(aes_(y = ~y, color = "black"), size = 0.7) +
geom_rect(data = res1, aes_(xmin = ~start_rect, xmax = ~end_rect, ymin = -Inf, ymax = Inf, group = ~name),fill = "grey",alpha = 0.1, na.rm = TRUE) +
geom_line(aes(color = "blue"),linetype = 1, size = 0.5) +
# fesis
geom_vline(data = my_ident_fesis, aes_(xintercept = ~time,color="red")) +
geom_ribbon(data = res1, aes_(ymin = ~cf_lwr, ymax = ~cf_upr, fill = "red", group = ~name), alpha = 0.5, na.rm = FALSE) +
geom_line(data = res1, aes_(y = ~cf, color = "red", group = ~name), na.rm = TRUE) +
# Faceting
facet_wrap("id", scales = facet.scales) +
scale_color_identity(name = NULL,
breaks = c("black", "blue", "grey", "purple", "red","darkgreen", "orange"),
labels = c("y","Fitted","IIS","SIS","FESIS","CFESIS", "CSIS"),
guide = "legend") +
scale_linetype(name = "Variable") +
guides(fill = "none") +
theme(
strip.background = element_blank(),
legend.key = element_rect(fill = NA),
panel.border = element_rect(colour = "grey",fill = NA),
panel.background = element_blank(),
) +
labs(title = title, subtitle = sub_title, y = NULL, x = NULL) -> plotoutput
return(plotoutput)
}
plot_counterfactual_positive(mod_noIIS$is[[1]])
plot_counterfactual_positive <- function(x, plus_t = 5, facet.scales = "free", title = NULL, zero_line = FALSE){
id <- c("DistrictofColumbia", "Kentucky", "SouthCarolina", "Tennessee", "Virginia", "Wisconsin")
time <- c(2011, 2007, 2008, 2005, 2005, 2014)
my_ident_fesis <- data.frame(id, time)
res <- identify_effects(x)
res$coef <- ifelse(res$coef<=0, NA, res$coef)
res$cf_upr <- ifelse(res$coef<=0, NA, res$cf_upr)
res$cf_lwr <- ifelse(res$coef<=0, NA, res$cf_lwr)
res$cf <- ifelse(res$coef<=0, NA, res$cf)
res1 <- res %>% filter(id %in% c("DistrictofColumbia", "Kentucky", "SouthCarolina", "Tennessee", "Virginia", "Wisconsin"))
sub_title <- NULL
ggplot(res1, aes_(
x = ~time,
y = ~fitted,
group = ~id
)) -> g
if(zero_line){g = g + geom_hline(aes(yintercept = 0))}
g +
geom_line(aes_(y = ~y, color = "black"), size = 0.7) +
geom_rect(data = res1, aes_(xmin = ~start_rect, xmax = ~end_rect, ymin = -Inf, ymax = Inf, group = ~name),fill = "grey",alpha = 0.1, na.rm = TRUE) +
geom_line(aes(color = "blue"),linetype = 1, size = 0.5) +
# fesis
geom_vline(data = my_ident_fesis, aes_(xintercept = ~time,color="red")) +
geom_ribbon(data = res1, aes_(ymin = ~cf_lwr, ymax = ~cf_upr, fill = "red", group = ~name), alpha = 0.5, na.rm = TRUE) +
geom_line(data = res1, aes_(y = ~cf, color = "red", group = ~name), na.rm = TRUE) +
# Faceting
facet_wrap("id", scales = facet.scales) +
scale_color_identity(name = NULL,
breaks = c("black", "blue", "grey", "purple", "red","darkgreen", "orange"),
labels = c("y","Fitted","IIS","SIS","FESIS","CFESIS", "CSIS"),
guide = "legend") +
scale_linetype(name = "Variable") +
guides(fill = "none") +
theme(
strip.background = element_blank(),
legend.key = element_rect(fill = NA),
panel.border = element_rect(colour = "grey",fill = NA),
panel.background = element_blank(),
) +
labs(title = title, subtitle = sub_title, y = NULL, x = NULL) -> plotoutput
return(plotoutput)
}
plot_counterfactual_positive(mod_noIIS$is[[1]])
plot_counterfactual_positive <- function(x, plus_t = 5, facet.scales = "free", title = NULL, zero_line = FALSE){
id <- c("DistrictofColumbia", "Kentucky", "SouthCarolina", "Tennessee", "Virginia", "Wisconsin")
time <- c(2011, 2007, 2008, 2005, 2005, 2014)
my_ident_fesis <- data.frame(id, time)
res <- identify_effects(x)
res$coef <- ifelse(res$coef<=0, NA, res$coef)
res$cf_upr <- ifelse(res$coef<=0, NA, res$cf_upr)
res$cf_lwr <- ifelse(res$coef<=0, NA, res$cf_lwr)
res$cf <- ifelse(res$coef<=0, NA, res$cf)
res1 <- res %>% filter(id %in% c("DistrictofColumbia", "Kentucky", "SouthCarolina", "Tennessee", "Virginia", "Wisconsin"))
sub_title <- NULL
ggplot(res1, aes_(
x = ~time,
y = ~fitted,
group = ~id
)) -> g
if(zero_line){g = g + geom_hline(aes(yintercept = 0))}
g +
geom_line(aes_(y = ~y, color = "black"), size = 0.7) +
geom_rect(data = res1, aes_(xmin = ~start_rect, xmax = ~end_rect, ymin = -Inf, ymax = Inf, group = ~name),fill = "grey",alpha = 0.1, na.rm = TRUE) +
geom_line(aes(color = "blue"),linetype = 1, size = 0.5) +
# fesis
geom_vline(data = my_ident_fesis, aes_(xintercept = ~time,color="red")) +
geom_ribbon(data = res1, aes_(ymin = ~cf_lwr, ymax = ~cf_upr, fill = "red", group = ~name), alpha = 0.5, na.rm = FALSE) +
geom_line(data = res1, aes_(y = ~cf, color = "red", group = ~name), na.rm = TRUE) +
# Faceting
facet_wrap("id", scales = facet.scales) +
scale_color_identity(name = NULL,
breaks = c("black", "blue", "grey", "purple", "red","darkgreen", "orange"),
labels = c("y","Fitted","IIS","SIS","FESIS","CFESIS", "CSIS"),
guide = "legend") +
scale_linetype(name = "Variable") +
guides(fill = "none") +
theme(
strip.background = element_blank(),
legend.key = element_rect(fill = NA),
panel.border = element_rect(colour = "grey",fill = NA),
panel.background = element_blank(),
) +
labs(title = title, subtitle = sub_title, y = NULL, x = NULL) -> plotoutput
return(plotoutput)
}
breaks_pos <- plot_counterfactual_positive(mod_noIIS$is[[1]])
breaks_pos
ggsave(".\\figures\\breaks_positive_1.png", plot = breaks_pos, device = "png", width = 7, height = 3)
plot_counterfactual_positive <- function(x, plus_t = 5, facet.scales = "free", title = NULL, zero_line = FALSE){
id <- c("DistrictofColumbia", "Kentucky", "SouthCarolina", "Tennessee", "Virginia", "Wisconsin")
time <- c(2011, 2007, 2008, 2005, 2005, 2014)
my_ident_fesis <- data.frame(id, time)
res <- identify_effects(x)
res$coef <- ifelse(res$coef<=0, NA, res$coef)
res$cf_upr <- ifelse(res$coef<0, NA, res$cf_upr)
res$cf_lwr <- ifelse(res$coef<0, NA, res$cf_lwr)
res$cf <- ifelse(res$coef<0, NA, res$cf)
res1 <- res %>% filter(id %in% c("DistrictofColumbia", "Kentucky", "SouthCarolina", "Tennessee", "Virginia", "Wisconsin"))
sub_title <- NULL
ggplot(res1, aes_(
x = ~time,
y = ~fitted,
group = ~id
)) -> g
if(zero_line){g = g + geom_hline(aes(yintercept = 0))}
g +
geom_line(aes_(y = ~y, color = "black"), size = 0.7) +
geom_rect(data = res1, aes_(xmin = ~start_rect, xmax = ~end_rect, ymin = -Inf, ymax = Inf, group = ~name),fill = "grey",alpha = 0.1, na.rm = TRUE) +
geom_line(aes(color = "blue"),linetype = 1, size = 0.5) +
# fesis
geom_vline(data = my_ident_fesis, aes_(xintercept = ~time,color="red")) +
geom_ribbon(data = res1, aes_(ymin = ~cf_lwr, ymax = ~cf_upr, fill = "red", group = ~name), alpha = 0.5, na.rm = FALSE) +
geom_line(data = res1, aes_(y = ~cf, color = "red", group = ~name), na.rm = TRUE) +
# Faceting
facet_wrap("id", scales = facet.scales) +
scale_color_identity(name = NULL,
breaks = c("black", "blue", "grey", "purple", "red","darkgreen", "orange"),
labels = c("y","Fitted","IIS","SIS","FESIS","CFESIS", "CSIS"),
guide = "legend") +
scale_linetype(name = "Variable") +
guides(fill = "none") +
theme(
strip.background = element_blank(),
legend.key = element_rect(fill = NA),
panel.border = element_rect(colour = "grey",fill = NA),
panel.background = element_blank(),
) +
labs(title = title, subtitle = sub_title, y = NULL, x = NULL) -> plotoutput
return(plotoutput)
}
breaks_pos <- plot_counterfactual_positive(mod_noIIS$is[[1]])
breaks_pos
res <- identify_effects(mod_noIIS$is[[1]]) # take output of model without IIS and transform into dataframe
breaks_pos <- plot_counterfactual_positive(mod_noIIS$is[[1]])
breaks_pos
rm(res)
res <- identify_effects(x)
res <- identify_effects(mod_noIIS$is[[1]])
res <- identify_effects(mod_noIIS$is[[1]])
res$cf <- ifelse(res$coef<=0, NA, res$cf)
res$cf <- ifelse(res$coef<=0, NA, res$cf)
res$cf <- ifelse(res$coef<=0, NA, res$cf
View(res)
View(res)
res <- identify_effects(mod_noIIS$is[[1]])
res$cf <- ifelse(res$coef<0, NA, res$cf)
plot_counterfactual_positive <- function(x, plus_t = 5, facet.scales = "free", title = NULL, zero_line = FALSE){
id <- c("DistrictofColumbia", "Kentucky", "SouthCarolina", "Tennessee", "Virginia", "Wisconsin")
time <- c(2011, 2007, 2008, 2005, 2005, 2014)
my_ident_fesis <- data.frame(id, time)
res <- identify_effects(x)
res$coef <- ifelse(res$coef<0, NA, res$coef)
res$cf_upr <- ifelse(res$coef<0, NA, res$cf_upr)
res$cf_lwr <- ifelse(res$coef<0, NA, res$cf_lwr)
res$cf <- ifelse(res$coef<0, NA, res$cf)
res1 <- res %>% filter(id %in% c("DistrictofColumbia", "Kentucky", "SouthCarolina", "Tennessee", "Virginia", "Wisconsin"))
sub_title <- NULL
ggplot(res1, aes_(
x = ~time,
y = ~fitted,
group = ~id
)) -> g
if(zero_line){g = g + geom_hline(aes(yintercept = 0))}
g +
geom_line(aes_(y = ~y, color = "black"), size = 0.7) +
geom_rect(data = res1, aes_(xmin = ~start_rect, xmax = ~end_rect, ymin = -Inf, ymax = Inf, group = ~name),fill = "grey",alpha = 0.1, na.rm = TRUE) +
geom_line(aes(color = "blue"),linetype = 1, size = 0.5) +
# fesis
geom_vline(data = my_ident_fesis, aes_(xintercept = ~time,color="red")) +
geom_ribbon(data = res1, aes_(ymin = ~cf_lwr, ymax = ~cf_upr, fill = "red", group = ~name), alpha = 0.5, na.rm = FALSE) +
geom_line(data = res1, aes_(y = ~cf, color = "red", group = ~name), na.rm = TRUE) +
# Faceting
facet_wrap("id", scales = facet.scales) +
scale_color_identity(name = NULL,
breaks = c("black", "blue", "grey", "purple", "red","darkgreen", "orange"),
labels = c("y","Fitted","IIS","SIS","FESIS","CFESIS", "CSIS"),
guide = "legend") +
scale_linetype(name = "Variable") +
guides(fill = "none") +
theme(
strip.background = element_blank(),
legend.key = element_rect(fill = NA),
panel.border = element_rect(colour = "grey",fill = NA),
panel.background = element_blank(),
) +
labs(title = title, subtitle = sub_title, y = NULL, x = NULL) -> plotoutput
return(plotoutput)
}
breaks_pos <- plot_counterfactual_positive(mod_noIIS$is[[1]])
breaks_pos
ggsave(".\\figures\\breaks_positive_1.png", plot = breaks_pos, device = "png", width = 7, height = 3)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(gets)
library(getspanel)
library(here)
library(doParallel)
library(readxl)
library(gdata)
library(cowplot)
mod <- readRDS(".\\model_spec\\results\\mods_main_updatedpackage.RDS")
mod_noIIS <- readRDS(".\\model_spec\\results\\mods_main_updatedpackage_noIIS.RDS")
other_results <- readRDS(here("model_spec/results/models_nonpat_2.RDS"))
other_results$is[[33]]
other_results[[33]]
other_results[33]
other_results[33,]
other_results <- readRDS(here("model_spec/results/models_2019.RDS"))
nrow(other_results)
other_results[33,]
other_results$is[[33]]
other_results$is[[33]]
policy <- read_csv("D:\\policy_database\\program_new.csv") %>%
select(!c(administrator, fromSir, additional_technologies))
state_info <- read_csv("D:\\policy_database\\state.csv")  %>%
select(!c(is_territory))
authority <- read_csv("D:\\policy_database\\authority.csv") %>%
select(!c(order,code, file_key, file_name, id, website, expired, expiredtext)) %>%
filter(if_any(c(effective, effectivetext), complete.cases)) %>%
distinct()
type <- read_csv("D:\\policy_database\\program_type.csv")
policy1 <- left_join(policy, type, by = c("program_type_id" = "id")) %>%
rename("policy_type" = "name.y",
"name" = "name.x") %>%
select(!c(program_category_id.y))
policy2 <- left_join(policy1, state_info, by = c("state_id" = "id")) %>% # join policy data + state data
rename("state_name" = "name.y",
"state_code" = "abbreviation",
"policy_id" = "id",
"policy_name" = "name.x",
"program_category" = "program_category_id.x") %>%
select(policy_id, state_name, state_code, policy_name, summary, policy_type, program_category, published, websiteurl, start_date, start_date_text)
policy2$start_year <- policy2 %>%
pull(start_date) %>%
year()
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(lubridate)
library(readxl)
library(pals)
library(treemapify)
library(viridis)
library(cowplot)
pols2 <- read_excel(".\\filtered_policies_by_positive_break.xlsx", sheet = 1) %>%
#filter(start_year > 2000) %>%
filter(!(start_year == "NA")) %>%
filter(case_when(state_name == "District of Columbia" ~ start_year > 2009 & start_year < 2013,
state_name == "South Carolina" ~ start_year > 2005 & start_year < 2011,
state_name == "Wisconsin" ~ start_year > 2006,
state_name == "Kentucky" ~ start_year > 2005 & start_year < 2009,
state_name == "Tennessee" ~ start_year > 1999 & start_year < 2011,
state_name == "Virginia" ~ start_year > 1996 & start_year < 2014))
filt_tab <- table(pol2$state_name)
filt_tab <- table(pols2$state_name)
filt_tab
pols <- read_excel(".\\filtered_policies_by_positive_break.xlsx", sheet = 1) %>%
tot_n <- as.data.frame(nonfilt_tab)
pols <- read_excel(".\\filtered_policies_by_positive_break.xlsx", sheet = 1)
nonfilt_tab <- table(pols$state_name)
nonfilt_tab
tot_n <- as.data.frame(nonfilt_tab)
found_n <- as.data.frame(filt_tab)
vs <- left_join(tot_n, found_n, by = "Var1") %>% rename("Total policies per state in DSIRE" = "Freq.x", "Policies within break CI" = "Freq.y")
View(vs)
pols <- read_excel(".\\filtered_policies_by_positive_break.xlsx", sheet = 1) %>%
drop_na()
pols <- read_excel(".\\filtered_policies_by_positive_break.xlsx", sheet = 1) %>%
drop_na()
filt_tab <- table(pols2$state_name)
nonfilt_tab <- table(pols$state_name)
tot_n <- as.data.frame(nonfilt_tab)
found_n <- as.data.frame(filt_tab)
vs <- left_join(tot_n, found_n, by = "Var1") %>% rename("Total policies per state in DSIRE" = "Freq.x", "Policies within break CI" = "Freq.y")
vs
pols <- read_excel(".\\filtered_policies_by_positive_break.xlsx", sheet = 1)
pols <- read_excel(".\\filtered_policies_by_positive_break.xlsx", sheet = 1)
filt_tab <- table(pols2$state_name)
nonfilt_tab <- table(pols$state_name)
tot_n <- as.data.frame(nonfilt_tab)
found_n <- as.data.frame(filt_tab)
vs <- left_join(tot_n, found_n, by = "Var1") %>% rename("Total policies per state in DSIRE" = "Freq.x", "Policies within break CI" = "Freq.y")
vs
